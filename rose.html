<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>...</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tiny5&display=swap" rel="stylesheet">
    <style>
        :root {
            font-smooth: never;
            -webkit-font-smoothing: none;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            background-color: #000;
            color: #fff;
            font-family: 'Tiny5', monospace;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            text-align: center;
        }

        .hidden { display: none !important; }

        #mainMenu {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #flowerContainer {
            cursor: pointer;
            transition: opacity 1s ease-in-out;
            margin-bottom: 30px;
        }

        #flowerImage { image-rendering: pixelated; }

        #menuButtons { display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .menu-button { font-size: 32px; cursor: pointer; color: #fff; }
        .menu-button:hover { color: yellow; }

        #idleText {
            margin-top: 20px;
            font-size: 24px;
            color: #555;
            opacity: 0;
            transition: opacity 2s ease-in-out;
        }

        .dialogue-box {
            width: 80%;
            max-width: 600px;
            min-height: 150px;
            padding: 30px;
            box-sizing: border-box;
            transition: all 0.5s ease;
            position: absolute;
        }
        .bordered {
            border: 4px solid #fff;
            background-color: #000;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .borderless { border: none; background-color: transparent; }
        .positioned-bottom { top: auto; bottom: 5%; left: 50%; transform: translateX(-50%); }

        .text-content {
            font-size: 32px;
            line-height: 1.4;
            letter-spacing: 2px;
            width: 100%;
            text-align: left;
            max-height: 140px;
            overflow-y: auto;
            padding-right: 15px;
        }
        .text-content::-webkit-scrollbar { width: 10px; }
        .text-content::-webkit-scrollbar-track { background: transparent; }
        .text-content::-webkit-scrollbar-thumb { background: #fff; border: 2px solid #000; }

        .text-content span.levitate-char { display: inline-block; opacity: 0; animation: fadeInChar 0.5s forwards, levitate 4s ease-in-out infinite; }

        #choiceContainer { margin-top: 20px; text-align: left; padding-left: 20px; }
        .choice-button { font-size: 32px; color: #fff; cursor: pointer; margin-right: 40px; opacity: 0; transition: opacity 1s; pointer-events: none; display: inline-block; }
        .choice-button:hover { color: yellow; }
        .choice-button.shake-on-hover:hover { animation: shake 0.4s infinite; }

        #skipButtonContainer {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 24px;
            color: #777;
            cursor: pointer;
        }
        #skipButton:hover { color: #ccc; }

        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex; justify-content: center; align-items: center;
            z-index: 100;
        }

        .scrollable-text { max-height: 40vh; overflow-y: auto; padding-right: 15px; text-align: left; font-size: 28px; line-height: 1.5; }
        .scrollable-text::-webkit-scrollbar { width: 10px; }
        .scrollable-text::-webkit-scrollbar-track { background: transparent; }
        .scrollable-text::-webkit-scrollbar-thumb { background: #fff; border: 2px solid #000; }
        #confirmationChoices { margin-top: 20px; }

        #progressArrow {
            position: absolute;
            bottom: 15px;
            right: 20px;
            width: 24px;
            height: auto;
            cursor: pointer;
            image-rendering: pixelated;
        }
        .arrow-bobbing {
            animation: bobbingArrow 1s ease-in-out infinite;
        }

        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        @keyframes fadeInChar { from { opacity: 0; } to { opacity: 1; } }
        @keyframes levitate { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); } 20%, 40%, 60%, 80% { transform: translateX(2px); } }
        @keyframes bobbingArrow { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(5px); } }
    </style>
</head>
<body>

    <div id="mainMenu">
        <div id="flowerContainer">
            <img id="flowerImage" src="https://github.com/F0nax9566/MrFonax/blob/main/files/rose.png?raw=true" alt="">
        </div>
        <div id="menuButtons">
            <span class="menu-button" id="part1Button">часть один</span>
            <span class="menu-button" id="part2Button">часть два</span>
            <span class="menu-button" id="part3Button">часть три</span>
        </div>
        <div id="idleText">* (вода начинает сохнуть.)</div>
    </div>

    <div id="dialogueContainer" class="dialogue-box bordered hidden">
        <div class="text-content" id="textContent"></div>
        <div id="choiceContainer"></div>
        <img src="https://github.com/F0nax9566/MrFonax/blob/main/files/arrow.png?raw=true" id="progressArrow" class="hidden">
    </div>

    <div id="skipButtonContainer" class="hidden"><span id="skipButton">пропустить?</span></div>

    <div id="confirmationModal" class="modal-overlay hidden">
        <div class="dialogue-box bordered">
            <div class="scrollable-text" id="confirmationText">
                вы уверены? это только для тех, кто уже знает сюжет первой части, и приведет вас к выбору. а ещё это сделал фонакс потому что ему было в падлу спамить когда он фиксил баг с кнопками, но забыл убрать это, зато не забыл добавить воды в этот текст.
            </div>
            <div id="confirmationChoices">
                <span class="choice-button" id="confirmYesButton">ода</span>
                <span class="choice-button" id="confirmNoButton">не надо</span>
            </div>
        </div>
    </div>

    <script>
        const mainMenu = document.getElementById('mainMenu');
        const flowerContainer = document.getElementById('flowerContainer');
        const dialogueContainer = document.getElementById('dialogueContainer');
        const textContent = document.getElementById('textContent');
        const choiceContainer = document.getElementById('choiceContainer');
        const progressArrow = document.getElementById('progressArrow');
        const idleText = document.getElementById('idleText');
        const part1Button = document.getElementById('part1Button');
        const part2Button = document.getElementById('part2Button');
        const part3Button = document.getElementById('part3Button');
        const skipButtonContainer = document.getElementById('skipButtonContainer');
        const skipButton = document.getElementById('skipButton');
        const confirmationModal = document.getElementById('confirmationModal');
        const confirmYesButton = document.getElementById('confirmYesButton');
        const confirmNoButton = document.getElementById('confirmNoButton');

        const sndTxt1 = new Audio("https://github.com/F0nax9566/MrFonax/raw/refs/heads/main/sounds/snd_txt1.wav");
        const sndLever = new Audio("https://github.com/F0nax9566/MrFonax/raw/refs/heads/main/sounds/lever-click.wav");
        const sndDoor = new Audio("https://github.com/F0nax9566/MrFonax/raw/refs/heads/main/sounds/door.wav");
        const bgMusic = new Audio("https://github.com/F0nax9566/MrFonax/raw/refs/heads/main/sounds/Undertale%20-%20Toby%20Fox.mp3");
        bgMusic.loop = true;

        const speakerSounds = [ new Audio("https://github.com/F0nax9566/MrFonax/raw/refs/heads/main/sounds/1.wav"), new Audio("https://github.com/F0nax9566/MrFonax/raw/refs/heads/main/sounds/3.wav") ];

        const storyDialogues = {
            rose: ["* (Кто-то заботливо полил цветок.)", "* (Цветок пахнет очень знакомо.)"],
            speaker: [ "* Эй.. тут кто-нибудь есть?", "* ...", "* Так ты всё-таки решил прийти сюда, хм?", "* Тебе стоило поливать его чаще, он.. был на грани.", "* Но это не так важно.", "* ...", "* Хех, а ведь правду говорят...", "* От судьбы не убежишь.", "* ...", "* Ты улыбаешься?", "* Ха... ха...", "* Похоже ты не зря его растил.", "* ...", "* Мне... жаль что я так поступил с тобой.", "* Просто постарайся меньше думать об этом, окей?" ],
            choice: "Полить цветок?",
            finale_yes: ["* Хороший выбор.", "* Тебе надо идти.", "* Пожалуйста, не задерживайся.", "* Тебя ждут великие дела."],
            finale_no: ["* ...", "* Он всёравно не был нужен тебе."]
        };
        const flowerClickDialogues = [ ["* (вы посмотрели на цветок.)", "* (цветок выглядит по-цветочьи)"], ["* (вы посмотрели на цветок... опять.)", "* (вам на секунду показалось что цветок покраснел)"], ["* (красивый цветок.)"], ["* (надежда.)"], ["* эй...", "* тебе.. он правда настолько нравится?"], ["* (вы посмотрели на цветок и ничего не добились.)", "* (вам кажется что стоит что-то начать делать.)"] ];
        const placeholderDialogue = [ "* извините, страница в разработке!", "* и нет, это точно не потому что фонакс наелся кляра и откинулся." ];
        const easterEggDialogue = [ "* Если ты читаешь это то ты руина.", "* Из всех возможных багов на сайте ты нашел только этот?", "* Думаешь самый умный?", "* Да, мне было легче написать диалог чем исправить этот баг, заставив кнопку пропасть во время проигрывания звука двери.", "* А теперь проваливай" ];

        let state = {
            mode: 'menu', branch: 'start', dialogueIndex: 0, flowerClickCount: 0,
            isTyping: false, canInteract: true, typingTimeout: null, idleTimer: null, currentText: ""
        };
        let savedState = {};
        let doorSoundTimeout = null;

        function typeText(text, config) {
            state.isTyping = true; state.canInteract = false; state.currentText = text;
            textContent.innerHTML = ''; choiceContainer.innerHTML = ''; 
            progressArrow.classList.remove('hidden', 'arrow-bobbing');
            let charIndex = 0;
            function typeChar() {
                if (charIndex < text.length) {
                    const char = text.charAt(charIndex);
                    if (config.mode === 'levitate') {
                        const span = document.createElement('span'); span.innerHTML = (char === ' ') ? '&nbsp;' : char;
                        span.className = 'levitate-char'; span.style.animationDelay = `${charIndex * 0.1}s, ${charIndex * 0.1}s`;
                        textContent.appendChild(span);
                    } else { textContent.innerHTML += char; }
                    if (config.soundPlayer && char !== ' ' && char !== '*') config.soundPlayer();
                    charIndex++; let delay = config.speed;
                    if ((char === '.' || char === ',') && text.charAt(charIndex) !== '(' && text.charAt(charIndex) !== ')') { delay += 300; }
                    state.typingTimeout = setTimeout(typeChar, delay);
                } else {
                    state.isTyping = false; 
                    progressArrow.classList.add('arrow-bobbing');
                    if (config.onComplete) config.onComplete();
                    else { state.canInteract = true; }
                }
            }
            typeChar();
        }

        function skipTyping() { if (!state.isTyping) return; clearTimeout(state.typingTimeout); state.isTyping = false; state.canInteract = true; textContent.innerHTML = state.currentText; progressArrow.classList.add('arrow-bobbing'); }
        function playRandomSpeakerSound() { const sound = speakerSounds[Math.floor(Math.random() * speakerSounds.length)]; sound.currentTime = 0; sound.play(); }
        function playSndTxt1() { sndTxt1.currentTime = 0; sndTxt1.play(); }

        function startIdleTimer() { idleText.style.opacity = 0; clearTimeout(state.idleTimer); state.idleTimer = setTimeout(() => { idleText.style.opacity = 1; }, 10000); }
        function resetInteraction() { clearTimeout(state.idleTimer); startIdleTimer(); }

        window.onload = startIdleTimer;

        part1Button.addEventListener('click', () => {
            if (!state.canInteract) return;
            resetInteraction(); state.mode = 'story'; state.branch = 'rose'; state.dialogueIndex = 0;
            mainMenu.classList.add('hidden');
            document.body.appendChild(flowerContainer);
            flowerContainer.style.opacity = 0;
            setTimeout(() => { dialogueContainer.classList.remove('hidden'); state.canInteract = true; nextStoryStep(); }, 500);
        });

        part2Button.addEventListener('click', () => handlePlaceholderClick());
        part3Button.addEventListener('click', () => handlePlaceholderClick());

        function nextStoryStep() {
            if (!state.canInteract) return;
            if (state.branch !== 'choice' && state.branch !== 'finale_yes' && state.branch !== 'finale_no') { skipButtonContainer.classList.remove('hidden'); }

            const currentBranchData = storyDialogues[state.branch];
            if (!currentBranchData || state.dialogueIndex >= currentBranchData.length) {
                const nextBranch = { 'rose': 'speaker', 'speaker': 'choice', 'finale_yes': 'end_yes', 'finale_no': 'end_no' }[state.branch];
                if (nextBranch) { state.branch = nextBranch; state.dialogueIndex = 0; handleStoryBranchTransition(); }
                return;
            }
            const text = currentBranchData[state.dialogueIndex];
            typeText(text, { speed: state.branch === 'rose' ? 60 : 80, soundPlayer: state.branch === 'rose' ? playSndTxt1 : playRandomSpeakerSound });
            state.dialogueIndex++;
        }

        function handleStoryBranchTransition() { if (state.branch === 'speaker') nextStoryStep(); if (state.branch === 'choice') { skipButtonContainer.classList.add('hidden'); runChoiceSequence();} if (state.branch === 'end_yes' || state.branch === 'end_no') window.close(); }
        function runChoiceSequence() { state.canInteract = false; sndLever.play(); dialogueContainer.classList.add('hidden'); flowerContainer.classList.remove('hidden'); setTimeout(() => { sndLever.play(); flowerContainer.style.opacity = 1; }, 500); setTimeout(() => { dialogueContainer.classList.replace('bordered', 'borderless'); dialogueContainer.classList.add('positioned-bottom'); dialogueContainer.classList.remove('hidden'); typeText(storyDialogues.choice, { speed: 100, mode: 'levitate', onComplete: showChoices }); }, 1500); }
        function showChoices() { progressArrow.classList.add('hidden'); const choices = ["Полить", "Прости"]; choices.forEach((choiceText, index) => { const button = document.createElement('span'); button.textContent = choiceText; button.className = 'choice-button'; if (choiceText === "Прости") button.classList.add('shake-on-hover'); button.onclick = (event) => { event.stopPropagation(); (choiceText === "Полить" ? handleChoiceYes() : handleChoiceNo()); }; choiceContainer.appendChild(button); setTimeout(() => { button.style.opacity = 1; button.style.pointerEvents = 'auto'; }, 500 * (index + 1)); }); state.canInteract = false; }
        function handleChoiceYes() { state.canInteract = false; choiceContainer.innerHTML = ''; textContent.innerHTML = ''; state.branch = 'finale_yes'; dialogueContainer.classList.replace('borderless', 'bordered'); typeText(storyDialogues.finale_yes[0], { speed: 80, soundPlayer: playRandomSpeakerSound, onComplete: () => { state.canInteract = false; setTimeout(() => { flowerContainer.style.animation = 'fadeOut 2s forwards'; dialogueContainer.classList.add('hidden'); progressArrow.classList.add('hidden'); setTimeout(() => { dialogueContainer.classList.remove('hidden'); dialogueContainer.classList.remove('positioned-bottom'); state.dialogueIndex = 1; fadeOutMusic(); state.canInteract = true; nextStoryStep(); }, 3000); }, 2000); } }); }
        function handleChoiceNo() { state.canInteract = false; bgMusic.pause(); document.body.innerHTML = ''; state.branch = 'finale_no'; setTimeout(() => { document.body.appendChild(dialogueContainer); dialogueContainer.classList.replace('borderless', 'bordered'); dialogueContainer.classList.remove('positioned-bottom'); dialogueContainer.classList.remove('hidden'); state.canInteract = true; nextStoryStep(); }, 3000); }
        function fadeOutMusic() { if (bgMusic.volume > 0.1) { state.musicInterval = setInterval(() => { bgMusic.volume = Math.max(0, bgMusic.volume - 0.05); if (bgMusic.volume === 0) clearInterval(state.musicInterval); }, 200); } }

        flowerContainer.addEventListener('click', (event) => { if(event.target.closest("#menuButtons")) return; if (state.mode !== 'menu' || !state.canInteract) return; resetInteraction(); state.mode = 'flower_click'; state.dialogueIndex = 0; mainMenu.classList.add('hidden'); dialogueContainer.classList.remove('hidden'); nextFlowerClickStep(); });
        function nextFlowerClickStep() { const dialogueSetIndex = Math.min(state.flowerClickCount, flowerClickDialogues.length - 1); const currentDialogueSet = flowerClickDialogues[dialogueSetIndex]; if (state.dialogueIndex >= currentDialogueSet.length) { state.flowerClickCount++; state.mode = 'menu'; dialogueContainer.classList.add('hidden'); progressArrow.classList.add('hidden'); mainMenu.classList.remove('hidden'); return; } const text = currentDialogueSet[state.dialogueIndex]; typeText(text, { speed: 80, soundPlayer: (dialogueSetIndex === 4) ? playRandomSpeakerSound : playSndTxt1 }); state.dialogueIndex++; }
        function handlePlaceholderClick() { if (!state.canInteract) return; resetInteraction(); state.mode = 'placeholder'; state.dialogueIndex = 0; mainMenu.classList.add('hidden'); dialogueContainer.classList.remove('hidden'); nextPlaceholderStep(); }
        function nextPlaceholderStep() { if (state.dialogueIndex >= placeholderDialogue.length) { state.mode = 'menu'; dialogueContainer.classList.add('hidden'); progressArrow.classList.add('hidden'); mainMenu.classList.remove('hidden'); return; } const text = placeholderDialogue[state.dialogueIndex]; typeText(text, { speed: 80, soundPlayer: playRandomSpeakerSound }); state.dialogueIndex++; }

        skipButton.addEventListener('click', () => {
            if (state.mode === 'story' && !state.canInteract && doorSoundTimeout) { triggerEasterEgg(); return; }
            if (state.isTyping) skipTyping();
            savedState = { text: state.currentText };
            confirmationModal.classList.remove('hidden');
            confirmYesButton.style.opacity = 1; confirmYesButton.style.pointerEvents = 'auto';
            confirmNoButton.style.opacity = 1; confirmNoButton.style.pointerEvents = 'auto';
        });

        function triggerEasterEgg() { clearTimeout(doorSoundTimeout); doorSoundTimeout = null; state.mode = 'easter_egg'; state.dialogueIndex = 0; confirmationModal.classList.add('hidden'); skipButtonContainer.classList.add('hidden'); dialogueContainer.classList.remove('hidden'); nextEasterEggStep(); }
        function nextEasterEggStep() { if (state.dialogueIndex >= easterEggDialogue.length) { window.location.href = 'https://www.youtube.com/watch?v=dQw4w9WgXcQ'; window.close(); return; } const text = easterEggDialogue[state.dialogueIndex]; typeText(text, { speed: 80, soundPlayer: playRandomSpeakerSound }); state.dialogueIndex++; }

        confirmYesButton.addEventListener('click', () => {
            confirmationModal.classList.add('hidden'); skipButtonContainer.classList.add('hidden'); dialogueContainer.classList.add('hidden');
            state.branch = 'choice'; 
            if (bgMusic.paused) { bgMusic.play(); } 
            runChoiceSequence();
        });

        confirmNoButton.addEventListener('click', () => { confirmationModal.classList.add('hidden'); textContent.innerHTML = savedState.text; state.isTyping = false; state.canInteract = true; progressArrow.classList.add('arrow-bobbing'); });

        progressArrow.addEventListener('click', () => {
            if (state.isTyping) {
                if (state.branch !== 'finale_yes' && state.branch !== 'finale_no' && state.branch !== 'choice') {
                    skipTyping();
                }
                return;
            }
            if (!state.canInteract) return;
            if (state.mode === 'story' && state.branch === 'choice') return;

            if (state.mode === 'story') {
                if (state.branch === 'speaker' && state.dialogueIndex === 2) {
                    state.canInteract = false; dialogueContainer.classList.add('hidden'); progressArrow.classList.add('hidden'); sndDoor.play();
                    doorSoundTimeout = setTimeout(() => {
                        bgMusic.play(); dialogueContainer.classList.remove('hidden');
                        state.canInteract = true; nextStoryStep();
                        doorSoundTimeout = null;
                    }, 2000);
                } else { nextStoryStep(); }
            } else if (state.mode === 'flower_click') { nextFlowerClickStep();
            } else if (state.mode === 'placeholder') { nextPlaceholderStep();
            } else if (state.mode === 'easter_egg') { nextEasterEggStep(); }
        });
    </script>
</body>
</html>
